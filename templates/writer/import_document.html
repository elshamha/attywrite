{% extends 'base.html' %}
{% load static %}

{% block title %}Import Document - A Writer's Web Dream{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'writer:dashboard' %}">Dashboard</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'writer:personal_library' %}">Personal Library</a></li>
                    <li class="breadcrumb-item active">Import Document</li>
                </ol>
            </nav>

            <div class="card">
                <div class="card-header">
                    <h2 class="mb-0">
                        <i class="fas fa-file-import text-primary"></i> Import Document
                    </h2>
                    <p class="mb-0 text-muted">Upload and convert documents from various formats</p>
                </div>
                <div class="card-body">
                    <!-- Supported Formats Info -->
                    <div class="alert alert-info" role="alert">
                        <h5><i class="fas fa-info-circle"></i> Supported Formats</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="mb-0">
                                    <li><i class="fas fa-file-pdf text-danger"></i> PDF Documents (.pdf)</li>
                                    <li><i class="fas fa-file-word text-primary"></i> Microsoft Word (.docx, .doc)</li>
                                    <li><i class="fas fa-file-alt text-secondary"></i> Plain Text (.txt)</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="mb-0">
                                    <li><i class="fas fa-file-alt text-warning"></i> Rich Text (.rtf)</li>
                                    <li><i class="fas fa-file-alt text-info"></i> OpenDocument (.odt)</li>
                                    <li><i class="fas fa-file-code text-success"></i> Markdown (.md)</li>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <form method="post" enctype="multipart/form-data" class="import-form">
                        {% csrf_token %}
                        
                        <!-- File Upload Section -->
                        <div class="form-section mb-4">
                            <h4 class="section-title">
                                <i class="fas fa-upload text-success"></i> File Upload
                            </h4>
                            
                            <div class="form-group mb-3">
                                <label for="{{ form.original_file.id_for_label }}" class="form-label">
                                    <i class="fas fa-file"></i> Select Document *
                                </label>
                                <div class="file-upload-area">
                                    {{ form.original_file }}
                                </div>
                                {% if form.original_file.help_text %}
                                    <div class="form-text">{{ form.original_file.help_text }}</div>
                                {% endif %}
                                {% if form.original_file.errors %}
                                    <div class="text-danger">{{ form.original_file.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Document Information -->
                        <div class="form-section mb-4">
                            <h4 class="section-title">
                                <i class="fas fa-info-circle text-info"></i> Document Information
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-8">
                                    <div class="form-group mb-3">
                                        <label for="{{ form.title.id_for_label }}" class="form-label">
                                            <i class="fas fa-heading"></i> Title *
                                        </label>
                                        {{ form.title }}
                                        {% if form.title.help_text %}
                                            <div class="form-text">{{ form.title.help_text }}</div>
                                        {% endif %}
                                        {% if form.title.errors %}
                                            <div class="text-danger">{{ form.title.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-group mb-3">
                                        <label for="{{ form.target_project.id_for_label }}" class="form-label">
                                            <i class="fas fa-folder"></i> Target Project
                                        </label>
                                        {{ form.target_project }}
                                        {% if form.target_project.help_text %}
                                            <div class="form-text">{{ form.target_project.help_text }}</div>
                                        {% endif %}
                                        {% if form.target_project.errors %}
                                            <div class="text-danger">{{ form.target_project.errors }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>

                            <div class="form-group mb-3">
                                <label for="{{ form.description.id_for_label }}" class="form-label">
                                    <i class="fas fa-align-left"></i> Description
                                </label>
                                {{ form.description }}
                                {% if form.description.help_text %}
                                    <div class="form-text">{{ form.description.help_text }}</div>
                                {% endif %}
                                {% if form.description.errors %}
                                    <div class="text-danger">{{ form.description.errors }}</div>
                                {% endif %}
                            </div>
                        </div>

                        <!-- Import Options -->
                        <div class="form-section mb-4">
                            <h4 class="section-title">
                                <i class="fas fa-cogs text-secondary"></i> Import Options
                            </h4>
                            
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        {{ form.preserve_formatting }}
                                        <label class="form-check-label" for="{{ form.preserve_formatting.id_for_label }}">
                                            <i class="fas fa-palette"></i> Preserve Formatting
                                        </label>
                                        {% if form.preserve_formatting.help_text %}
                                            <div class="form-text">{{ form.preserve_formatting.help_text }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check mb-3">
                                        {{ form.extract_metadata }}
                                        <label class="form-check-label" for="{{ form.extract_metadata.id_for_label }}">
                                            <i class="fas fa-info"></i> Extract Metadata
                                        </label>
                                        {% if form.extract_metadata.help_text %}
                                            <div class="form-text">{{ form.extract_metadata.help_text }}</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions d-flex justify-content-between">
                            <a href="{% url 'writer:personal_library' %}" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left"></i> Cancel
                            </a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-upload"></i> Import Document
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tips and Guidelines -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5><i class="fas fa-lightbulb text-warning"></i> Import Tips & Guidelines</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-check text-success"></i> Best Practices</h6>
                            <ul class="small">
                                <li>Use descriptive titles for easy identification</li>
                                <li>Assign to a project for better organization</li>
                                <li>Check "Preserve Formatting" for styled documents</li>
                                <li>Enable metadata extraction for detailed information</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-exclamation-triangle text-warning"></i> Limitations</h6>
                            <ul class="small">
                                <li>Maximum file size: 50 MB</li>
                                <li>Complex layouts may not convert perfectly</li>
                                <li>Images and tables are converted to text descriptions</li>
                                <li>Some formatting may be lost during conversion</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
.import-form .form-control, 
.import-form .form-select {
    border-radius: 8px;
    border: 1px solid #ced4da;
    padding: 10px;
}

.import-form .form-control:focus,
.import-form .form-select:focus {
    border-color: #007bff;
    box-shadow: 0 0 0 0.2rem rgba(0, 123, 255, 0.25);
}

.form-section {
    border: 1px solid #e9ecef;
    border-radius: 10px;
    padding: 20px;
    background: #f8f9fa;
}

.section-title {
    color: #495057;
    margin-bottom: 15px;
    border-bottom: 2px solid #dee2e6;
    padding-bottom: 8px;
}

.form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 8px;
}

.form-label i {
    margin-right: 5px;
    width: 16px;
}

.file-upload-area {
    border: 2px dashed #dee2e6;
    border-radius: 10px;
    padding: 20px;
    text-align: center;
    background: #fff;
    transition: border-color 0.3s;
}

.file-upload-area:hover {
    border-color: #007bff;
}

.form-actions {
    margin-top: 30px;
    padding-top: 20px;
    border-top: 2px solid #dee2e6;
}

.form-check-label {
    font-weight: 500;
}

.form-check-label i {
    margin-right: 5px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Auto-populate title from filename
    const fileInput = document.querySelector('input[type="file"]');
    const titleInput = document.querySelector('input[name="title"]');
    
    if (fileInput && titleInput) {
        fileInput.addEventListener('change', function() {
            if (this.files.length > 0 && !titleInput.value) {
                const filename = this.files[0].name;
                const title = filename.replace(/\.[^/.]+$/, ""); // Remove extension
                titleInput.value = title;
            }
        });
    }
});
</script>
{% endblock %}
