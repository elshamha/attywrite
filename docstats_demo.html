<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Live Document Statistics Demo</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 0; padding: 2em; }
        #stats { background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #eee; padding: 2em; max-width: 400px; margin: auto; }
        h2 { margin-top: 0; }
        .stat { font-size: 1.2em; margin: 1em 0; }
        textarea { width: 100%; height: 120px; margin-bottom: 1em; }
        button { padding: 0.5em 1em; border-radius: 4px; border: none; background: #007bff; color: #fff; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div id="stats">
        <h2>Live Document Statistics</h2>
        <textarea id="docInput" placeholder="Type or paste your document here..."></textarea>
        <button onclick="sendStats()">Update Stats</button>
        <div class="stat">Word Count: <span id="wordCount">0</span></div>
        <div class="stat">Reading Time (min): <span id="readingTime">0</span></div>
        <div class="stat">Flesch Score: <span id="flesch">0</span></div>
    </div>
    <script>
        const ws = new WebSocket('ws://' + window.location.host + '/ws/docstats/');
        ws.onmessage = function(event) {
            const data = JSON.parse(event.data);
            document.getElementById('wordCount').textContent = data.word_count;
            document.getElementById('readingTime').textContent = data.reading_time;
            document.getElementById('flesch').textContent = data.flesch;
        };
        function fleschReadingEase(text) {
            // Simple Flesch score: 206.835 - 1.015*(words/sentences) - 84.6*(syllables/words)
            const sentences = text.split(/[.!?]+/).filter(Boolean).length || 1;
            const words = text.split(/\s+/).filter(Boolean);
            const wordCount = words.length;
            let syllables = 0;
            for (let word of words) {
                syllables += word.toLowerCase().replace(/(?:[^laeiouy]e|ed|[^laeiouy]es)$/,'').match(/[aeiouy]{1,2}/g)?.length || 1;
            }
            return Math.round(206.835 - 1.015 * (wordCount / sentences) - 84.6 * (syllables / wordCount));
        }
        function sendStats() {
            const text = document.getElementById('docInput').value;
            const wordCount = text.split(/\s+/).filter(Boolean).length;
            const readingTime = (wordCount / 200).toFixed(2); // 200 wpm
            const flesch = fleschReadingEase(text);
            ws.send(JSON.stringify({ word_count: wordCount, reading_time: readingTime, flesch: flesch }));
        }
    </script>
</body>
</html>
