<!DOCTYPE html>
<html>
<head>
    <title>Live Whiteboard Demo</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f8fafc; }
        #whiteboard { display: block; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 8px #ccc; }
        #controls { width: 600px; margin: 0 auto 16px auto; text-align: center; }
        label, select, input { margin: 0 8px; }
    </style>
</head>
<body>
    <div id="controls">
        <label>Color: <input type="color" id="color" value="#000000"></label>
        <label>Width: <input type="number" id="width" value="2" min="1" max="20"></label>
    </div>
    <canvas id="whiteboard" width="600" height="400"></canvas>
    <script>
        const ws = new WebSocket('ws://127.0.0.1:8000/ws/whiteboard/');
        const canvas = document.getElementById('whiteboard');
        const ctx = canvas.getContext('2d');
        let drawing = false, x0 = 0, y0 = 0;

        canvas.addEventListener('mousedown', e => {
            drawing = true;
            [x0, y0] = [e.offsetX, e.offsetY];
        });
        canvas.addEventListener('mouseup', e => {
            drawing = false;
        });
        canvas.addEventListener('mouseout', e => {
            drawing = false;
        });
        canvas.addEventListener('mousemove', e => {
            if (!drawing) return;
            const x1 = e.offsetX, y1 = e.offsetY;
            const color = document.getElementById('color').value;
            const width = parseInt(document.getElementById('width').value, 10);
            drawLine(x0, y0, x1, y1, color, width);
            ws.send(JSON.stringify({draw: {x0, y0, x1, y1, color, width}}));
            [x0, y0] = [x1, y1];
        });

        ws.onmessage = function(event) {
            let data;
            try { data = JSON.parse(event.data); } catch { return; }
            if (data.draw) {
                const d = data.draw;
                drawLine(d.x0, d.y0, d.x1, d.y1, d.color, d.width);
            }
        };

        function drawLine(x0, y0, x1, y1, color, width) {
            ctx.strokeStyle = color;
            ctx.lineWidth = width;
            ctx.beginPath();
            ctx.moveTo(x0, y0);
            ctx.lineTo(x1, y1);
            ctx.stroke();
        }
    </script>
</body>
</html>
